<!DOCTYPE html>
{% load static %}
<html>
    <head>
           <title></title>

           <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1" />

           <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
           <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

           <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">

           <script type="text/javascript">
                    var user = '{{request.user}}'
                    function getCookie(name) {
                        let cookieValue = null;
                        if (document.cookie && document.cookie !== '') {
                            const cookies = document.cookie.split(';');
                            for (let i = 0; i < cookies.length; i++) {
                                const cookie = cookies[i].trim();
                                // Does this cookie string begin with the name we want?
                                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        return cookieValue;
                    }
                    const csrftoken = getCookie('csrftoken');
           </script>
    

     </head>
     <body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'store' %}">
                <img src="{% static 'images/balloon-heart-fill.svg' %}" alt="Logo" width="30" height="24" class="d-inline-block align-text-top">
                Store
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Categories
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="{% url 'store' %}">All Categories</a></li>
                            <li><hr class="dropdown-divider"></li>
                            {% for category in categories %}
                            <li class="dropdown-submenu">
                                <a class="dropdown-item dropdown-toggle" href="#" id="dropdownSubMenu{{ category.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                    {{ category.name }}
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="dropdownSubMenu{{ category.id }}">
                                    <li><a class="dropdown-item" href="{% url 'category' category.name %}">View All {{ category.name }}</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    {% for subcategory in category.subcategories.all %}
                                        <li><a class="dropdown-item" href="{% url 'subcategory' category.name subcategory.name %}">{{ subcategory.name }}</a></li>
                                    {% endfor %}
                                </ul>
                            </li>
                            {% endfor %}
                        </ul>
                    </li>
                </ul>
    
                <form action="{% url 'search' %}" method="GET" class="d-flex">
                    
                    <select name="category" class="form-select me-2">
                        <option value="">Select Category</option>
                        {% for category in categories %} 
                            <option value="{{ category.name }}" {% if category.name == selected_category %}selected{% endif %}>{{ category.name }}</option>
                        {% endfor %}
                        <input type="text" class="form-control me-2" name="q" placeholder="Search.." value="{{ query }}">
                    </select>
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>


            {% if user.is_authenticated %}
                <div class="dropdown">
                    <img  src="{% static 'images/person.svg' %}" class="dropdown-toggle" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false" alt="Dropdown Image">
                    
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton1">
                        <li><a class="dropdown-item" href="{% url 'profile' %}">Profile</a></li>
                        <li><a class="dropdown-item" href="{% url 'logout' %}">Logout</a></li>
                    </ul>
            </div> 
            {% else %}
            <div class="dropdown">
                <img  src="{% static 'images/person.svg' %}" class="dropdown-toggle" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false" alt="Dropdown Image">
                    <form method="POST" action="{% url 'login' %}">
                        {% csrf_token %}
                        <ul class="dropdown-menu dropdown-menu-end mx-auto" aria-labelledby="dropdownMenuButton1">
                            <li>
                                <div class="mb-3">
                                    <label for="InputUsername" class="form-label loginicon">Username</label>
                                    <input name="username" id="username" type="text" class="form-control" aria-label="username" aria-describedby="basic-addon1">    
                                </div>
                            </li>
                            <li>
                                <div class="mb-3">
                                    <label for="InputPassword1" class="form-label loginicon">Password</label>
                                    <input name="password" id="password" type="password" class="form-control">    
                              </div>
                          
                            </li>
                            <li>
                                <button type="submit" class="btn btn-primary">Log in</button>
                                <a class="dropdown-item" href="{% url 'register' %}">Register</a>

                            </li>
                        </ul>
                    </form>
                    

            </div>
       
        {% endif %}
           
                <a href="{% url 'cart' %}" class="nav-right-link w-inline-block">
                    <div>
                        <img id="profile-icon" src="{% static 'images/bag.svg' %}">
                    </div>
                </a>
                <p id="cartTotal">{{cartItems}}</p>
           
                    
            
       
      </nav>
      
      {% if request.resolver_match.url_name == 'store' %}
      <div class="banner">
        <img src="{% static 'images/Banner.webp' %}" alt=""/>
        <div class="card-img-overlay text-center">
         
        </div>
    </div>
    {% endif %}



        <div class="container">
            <br>
            {% block content %}
            
            
            {% endblock content %}
        </div>

<!--BOOTSTRAP JAVA-->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="{% static 'js/cart.js' %}"></script>
    <script src="{% static 'js/function.js' %}"></script>

</body>
</html>